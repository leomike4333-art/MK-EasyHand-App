<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MK EasyHand App â€“ Paste & Click</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: Arial, Helvetica, sans-serif;
  background:#f4f4f4;
  margin:0;
  padding:14px;
}
h1{margin:0 0 6px;font-size:22px}
.small{font-size:13px;color:#666}
.panel{
  background:#fff;
  border-radius:10px;
  padding:12px;
  margin-bottom:12px;
}
.row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
button{
  padding:8px 12px;
  font-size:14px;
  border-radius:8px;
  border:0;
  cursor:pointer;
  background:#1976d2;
  color:white;
}
button.gray{background:#666}
input,select{
  padding:6px;
  font-size:14px;
}
#imgPreview{
  max-width:100%;
  border:1px solid #ccc;
  margin-top:8px;
  display:none;
}
.ok{color:green;font-weight:bold}
.err{color:#b00020;font-weight:bold}
</style>
</head>

<body>

<h1>MK EasyHand App</h1>
<div class="small">
Screenshot â†’ Paste â†’ Click image â†’ Next steps (Solver / BBO)
</div>

<!-- SOURCE + IMAGE -->
<div class="panel">
  <div class="row">
    <label><b>Source:</b></label>
    <select id="source">
      <option>A â€“ RealBridge</option>
      <option>B â€“ BBO</option>
      <option>C â€“ Federation / Local</option>
      <option>D â€“ LoveBridge (WBF)</option>
      <option>E â€“ Bulletin (ACBL / EBL / WBF)</option>
    </select>

    <button id="pasteBtn">ðŸ“‹ Paste</button>
    <input type="file" id="fileInput" accept="image/*">
  </div>

  <div id="pasteMsg" class="small"></div>

  <img id="imgPreview">
  <div id="clickMsg" class="small"></div>
</div>

<!-- STATUS -->
<div class="panel">
  <b>Status</b>
  <div id="status" class="small">Waiting for imageâ€¦</div>
</div>

<script>
const imgPreview = document.getElementById("imgPreview");
const pasteBtn = document.getElementById("pasteBtn");
const fileInput = document.getElementById("fileInput");
const pasteMsg = document.getElementById("pasteMsg");
const clickMsg = document.getElementById("clickMsg");
const statusBox = document.getElementById("status");

// ---------- IMAGE HANDLING ----------
function showImage(blob, origin){
  const url = URL.createObjectURL(blob);
  imgPreview.src = url;
  imgPreview.style.display = "block";
  pasteMsg.textContent = origin;
  statusBox.textContent = "Image ready. Click on it.";
}

// ---------- PASTE FROM CLIPBOARD ----------
pasteBtn.onclick = async () => {
  pasteMsg.textContent = "";
  if(!navigator.clipboard || !navigator.clipboard.read){
    pasteMsg.textContent = "Clipboard paste not supported here.";
    return;
  }
  try{
    const items = await navigator.clipboard.read();
    for(const it of items){
      const t = it.types.find(x => x.startsWith("image/"));
      if(t){
        const blob = await it.getType(t);
        showImage(blob, "Image pasted from clipboard.");
        return;
      }
    }
    pasteMsg.textContent = "No image in clipboard.";
  }catch(err){
    pasteMsg.textContent = "Clipboard access denied (HTTPS required).";
  }
};

// ---------- FILE UPLOAD ----------
fileInput.onchange = () => {
  const f = fileInput.files[0];
  if(!f) return;
  showImage(f, "Image loaded from file.");
};

// ---------- CLICK DETECTION ----------
function handleClick(e){
  if(imgPreview.style.display === "none") return;

  const rect = imgPreview.getBoundingClientRect();
  const cx = e.touches ? e.touches[0].clientX : e.clientX;
  const cy = e.touches ? e.touches[0].clientY : e.clientY;

  const x = Math.round(cx - rect.left);
  const y = Math.round(cy - rect.top);

  const nx = (x / rect.width).toFixed(3);
  const ny = (y / rect.height).toFixed(3);

  clickMsg.innerHTML =
    `Clicked at x=${x}, y=${y} &nbsp; | &nbsp; normalized (${nx}, ${ny})`;
}

imgPreview.addEventListener("click", handleClick);
imgPreview.addEventListener("touchstart", handleClick, {passive:true});
</script>

</body>
</html>
