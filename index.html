<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>MK-EasyHand-App</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  margin: 0;
  padding: 12px;
}
h1 { font-size: 20px; margin-bottom: 8px; }
.panel {
  background: white;
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 12px;
}
.row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
}
select, button {
  padding: 6px 10px;
  font-size: 14px;
}
button {
  cursor: pointer;
}
#imgPreview {
  max-width: 100%;
  border: 1px solid #ccc;
  margin-top: 8px;
  display: none;
}
.muted { color: #666; font-size: 13px; }
.success { color: green; }
.warn { color: darkorange; }
</style>
</head>

<body>

<h1>MK-EasyHand-App</h1>
<div class="muted">Screenshot â†’ Analisi mano (Bridge Solver / BBO)</div>

<div class="panel">
  <div class="row">
    <label><b>Source:</b></label>
    <select id="source">
      <option>A â€“ RealBridge</option>
      <option>B â€“ BBO</option>
      <option>C â€“ Federation / Local</option>
      <option>D â€“ LoveBridge (WBF)</option>
      <option>E â€“ Bulletin (ACBL / EBL / WBF)</option>
    </select>

    <button id="pasteBtn">ðŸ“‹ Incolla</button>

    <label for="fileInput" class="muted">oppure</label>
    <input type="file" id="fileInput" accept="image/*">
  </div>

  <div id="pasteStatus" class="muted"></div>
  <img id="imgPreview">
</div>

<div class="panel">
  <b>Stato:</b>
  <div id="status" class="muted">In attesa di immagineâ€¦</div>
</div>

<script>
const pasteBtn = document.getElementById("pasteBtn");
const pasteStatus = document.getElementById("pasteStatus");
const imgPreview = document.getElementById("imgPreview");
const statusBox = document.getElementById("status");
const fileInput = document.getElementById("fileInput");

function handleImage(blob, fromClipboard=false) {
  const url = URL.createObjectURL(blob);
  imgPreview.src = url;
  imgPreview.style.display = "block";
  statusBox.innerHTML = "Immagine caricata âœ…<br>Pronta per estrazione mano.";
  pasteStatus.innerHTML = fromClipboard
    ? "<span class='success'>Screenshot incollato dagli appunti</span>"
    : "";
}

pasteBtn.addEventListener("click", async () => {
  pasteStatus.textContent = "";
  if (!navigator.clipboard || !navigator.clipboard.read) {
    pasteStatus.innerHTML = "<span class='warn'>Incolla non supportato qui. Usa Carica file.</span>";
    return;
  }
  try {
    const items = await navigator.clipboard.read();
    for (const item of items) {
      const type = item.types.find(t => t.startsWith("image/"));
      if (type) {
        const blob = await item.getType(type);
        handleImage(blob, true);
        return;
      }
    }
    pasteStatus.innerHTML = "<span class='warn'>Nessuna immagine negli appunti.</span>";
  } catch (err) {
    pasteStatus.innerHTML = "<span class='warn'>Permesso negato o HTTPS richiesto.</span>";
    console.error(err);
  }
});

fileInput.addEventListener("change", () => {
  if (fileInput.files && fileInput.files[0]) {
    handleImage(fileInput.files[0], false);
  }
});
</script>

</body>
</html>
