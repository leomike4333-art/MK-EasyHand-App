<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MK EasyHand – FAST (RealBridge / BBO)</title>

<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f2f2f2;margin:0;padding:20px}
h1{margin:0 0 10px 0}
.box{background:#fff;padding:14px;border-radius:12px;margin-bottom:14px}
.small{color:#555;font-size:13px}
.row{display:flex;align-items:center;gap:10px;margin:6px 0}
.seat{font-weight:bold;margin-top:10px}
.suit{width:22px}
input{flex:1;padding:8px;border-radius:8px;border:1px solid #ccc}
button{padding:10px 14px;border:none;border-radius:10px;background:#1976d2;color:#fff;font-size:15px;cursor:pointer}
button.secondary{background:#666}
button.good{background:#0a7a2f}
button.warn{background:#b00020}
textarea{width:100%;height:120px;font-family:monospace;font-size:13px}
.actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
.ok{color:#0a7a2f;font-weight:bold}
.bad{color:#b00020;font-weight:bold}
#debug{white-space:pre-wrap;background:#f7f7f7;border-radius:8px;padding:10px;font-size:12px;margin-top:10px}
label{font-weight:bold}
select{padding:6px 10px;border-radius:8px}
</style>
</head>

<body>

<h1>MK EasyHand – FAST</h1>

<div class="box">
  <label>Tipo screenshot:</label>
  <select id="shotType">
    <option value="A">A – RealBridge</option>
    <option value="B">B – BBO</option>
  </select>
  <div class="small">Serve solo per sapere che tipo di layout stiamo analizzando.</div>
</div>

<div class="box">
  <label>Screenshot (solo riferimento visivo)</label>
  <input type="file" accept="image/*" id="imgInput">
  <div class="small">Per ora lo carichiamo solo come promemoria visivo.</div>
</div>

<div class="box">
  <b>Inserisci la mano</b>
  <div class="small">Usa 10 oppure T. Una sola mano, focus didattico.</div>

  <div class="seat">NORD</div>
  <div class="row"><div class="suit">♠</div><input id="nS"></div>
  <div class="row"><div class="suit">♥</div><input id="nH"></div>
  <div class="row"><div class="suit">♦</div><input id="nD"></div>
  <div class="row"><div class="suit">♣</div><input id="nC"></div>

  <div class="seat">EST</div>
  <div class="row"><div class="suit">♠</div><input id="eS"></div>
  <div class="row"><div class="suit">♥</div><input id="eH"></div>
  <div class="row"><div class="suit">♦</div><input id="eD"></div>
  <div class="row"><div class="suit">♣</div><input id="eC"></div>

  <div class="seat">SUD</div>
  <div class="row"><div class="suit">♠</div><input id="sS"></div>
  <div class="row"><div class="suit">♥</div><input id="sH"></div>
  <div class="row"><div class="suit">♦</div><input id="sD"></div>
  <div class="row"><div class="suit">♣</div><input id="sC"></div>

  <div class="seat">OVEST</div>
  <div class="row"><div class="suit">♠</div><input id="wS"></div>
  <div class="row"><div class="suit">♥</div><input id="wH"></div>
  <div class="row"><div class="suit">♦</div><input id="wD"></div>
  <div class="row"><div class="suit">♣</div><input id="wC"></div>

  <div class="actions">
    <button id="genBtn" class="good">Genera LIN / PBN</button>
    <span id="msg"></span>
  </div>

  <div id="debug">DEBUG: pronto</div>
</div>

<div class="box">
  <b>Output LIN</b>
  <textarea id="outLIN" readonly></textarea>
  <div class="actions">
    <button id="copyLin" class="secondary">Copia LIN</button>
    <button id="dlLin">Scarica .lin</button>
  </div>
</div>

<div class="box">
  <b>Output PBN</b>
  <textarea id="outPBN" readonly></textarea>
</div>

<script>
const RANKS="AKQJT98765432";
const $=id=>document.getElementById(id);
const norm=t=>(t||"").toUpperCase().replace(/10/g,"T").replace(/[^AKQJT98765432]/g,"");

function v(id){return norm($(id).value);}

function readHands(){
  return{
    N:{S:v("nS"),H:v("nH"),D:v("nD"),C:v("nC")},
    E:{S:v("eS"),H:v("eH"),D:v("eD"),C:v("eC")},
    S:{S:v("sS"),H:v("sH"),D:v("sD"),C:v("sC")},
    W:{S:v("wS"),H:v("wH"),D:v("wD"),C:v("wC")}
  };
}

function validate(h){
  let seen=new Set(),tot=0,err=[];
  for(const p of["N","E","S","W"]){
    let c=0;
    for(const s of["S","H","D","C"]){
      for(const r of h[p][s]){
        tot++;c++;
        const k=s+r;
        if(seen.has(k))err.push("Doppione "+k);
        seen.add(k);
      }
    }
    if(c!==13)err.push("Seat "+p+": "+c+" carte");
  }
  return{ok:err.length===0&&tot===52,tot,err};
}

$("genBtn").onclick=()=>{
  document.activeElement&&document.activeElement.blur();
  setTimeout(()=>{
    const h=readHands();
    $("debug").textContent=
`DEBUG
N ${h.N.S}.${h.N.H}.${h.N.D}.${h.N.C}
E ${h.E.S}.${h.E.H}.${h.E.D}.${h.E.C}
S ${h.S.S}.${h.S.H}.${h.S.D}.${h.S.C}
W ${h.W.S}.${h.W.H}.${h.W.D}.${h.W.C}`;

    const vld=validate(h);
    if(!vld.ok){
      $("msg").innerHTML=`<span class="bad">KO (${vld.tot})</span>`;
      return;
    }

    $("msg").innerHTML=`<span class="ok">OK</span>`;

    const N=`${h.N.S}.${h.N.H}.${h.N.D}.${h.N.C}`;
    const E=`${h.E.S}.${h.E.H}.${h.E.D}.${h.E.C}`;
    const S=`${h.S.S}.${h.S.H}.${h.S.D}.${h.S.C}`;
    const W=`${h.W.S}.${h.W.H}.${h.W.D}.${h.W.C}`;

    $("outPBN").value=
`[Board "1"]
[Dealer "N"]
[Vulnerable "None"]
[Deal "N:${N} ${E} ${S} ${W}"]`;

    $("outLIN").value=
`pn|N,E,S,W|sv|o|bd|1|md|3${h.N.S+h.N.H+h.N.D+h.N.C},${h.W.S+h.W.H+h.W.D+h.W.C},${h.E.S+h.E.H+h.E.D+h.E.C},${h.S.S+h.S.H+h.S.D+h.S.C}|`;
  },0);
};

$("copyLin").onclick=()=>navigator.clipboard.writeText($("outLIN").value);
$("dlLin").onclick=()=>{
  const b=new Blob([$(`outLIN`).value],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="board.lin";
  a.click();
};
</script>

</body>
</html>
